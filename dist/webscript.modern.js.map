{"version":3,"file":"webscript.modern.js","sources":["../src/webscript.js"],"sourcesContent":["function templateValues(args) {\r\n  const [strings, ...templateArgs] = args;\r\n  const result = [];\r\n  for (const [index, s] of strings.entries()) {\r\n    if (s !== \"\") {\r\n      result.push(s);\r\n    }\r\n    let arg = templateArgs[index];\r\n    if (typeof arg !== \"undefined\") {\r\n      result.push(arg);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nlet interpunct = new RegExp(\"·\", \"g\");\r\n\r\nexport const enhanceBuilder = (builder, func) => {\r\n  builder.__webscript_enhancer = func;\r\n  return builder;\r\n}\r\n\r\nfunction createInitialBuilder(constructor, type) {\r\n  function createBuilder(props, prop) {\r\n    let builder = new Proxy(() => { }, {\r\n      apply(target, thisArg, children) {\r\n        if (typeof target.__webscript_enhancer === \"function\") {\r\n          let __webscript_enhancer = target.__webscript_enhancer;\r\n          delete target.__webscript_enhancer;\r\n          let result = __webscript_enhancer(builder, children);\r\n          target.__webscript_enhancer = __webscript_enhancer;\r\n          return result;\r\n        }\r\n        let [first] = children;\r\n        if (Array.isArray(first) && Object.isFrozen(first)) {\r\n          children = templateValues(children);\r\n        }\r\n        if (Array.isArray(props.children)) {\r\n          props.children.push(...children)\r\n          children = props.children;\r\n          delete props.children;\r\n        }\r\n        for (let i = 0; i < children.length; i++) {\r\n          let arg = children[i];\r\n          if (typeof arg === \"function\" && arg.__is_webscript_element === true) {\r\n            children[i] = arg();\r\n          }\r\n        }\r\n        return constructor(type, props, ...children);\r\n      },\r\n      get(target, elementName) {\r\n        if (typeof elementName === \"string\") {\r\n          if (elementName === \"__is_webscript_element\") {\r\n            return true;\r\n          }\r\n          else if (elementName === \"__webscript_enhancer\") {\r\n            return target[elementName]\r\n          }\r\n          else if (elementName.indexOf(\"·\") !== -1) {\r\n            elementName = elementName.replace(interpunct, \"-\");\r\n          }\r\n\r\n          function setPropertyValue(...args) {\r\n            let [value] = args;\r\n            if (typeof value === \"undefined\") {\r\n              if (prop === \"props\" && Object.prototype.toString.call(value) === '[object Object]') {\r\n                return createBuilder({}, null);\r\n              }\r\n              let newProps = { ...props };\r\n              delete newProps[prop];\r\n              return createBuilder(newProps, null);\r\n            }\r\n            else if (Array.isArray(value) && Object.isFrozen(value)) {\r\n              value = templateValues(args).join(\"\");\r\n            }\r\n            else if (args.length > 1) {\r\n              value = args;\r\n            }\r\n            else if (prop === \"props\" && Object.prototype.toString.call(value) === '[object Object]') {\r\n              return createBuilder({ ...props, ...value }, null);\r\n            }\r\n            const newProps = { ...props, [prop]: value };\r\n            return createBuilder(newProps, null);\r\n          }\r\n          if (elementName === \"props\") {\r\n            setPropertyValue.value = props;\r\n          }\r\n          else {\r\n            setPropertyValue.value = props[elementName];\r\n          }\r\n          prop = elementName;\r\n          return setPropertyValue;\r\n        }\r\n      }\r\n    })\r\n    return builder;\r\n  }\r\n  return createBuilder({}, null);\r\n}\r\n\r\n\r\nfunction builders(constructor, types = []) {\r\n  if (typeof constructor !== \"function\") {\r\n    throw Error(\"elementConstructor argument must be present and it must be a function.\");\r\n  }\r\n  if (types.length > 0) {\r\n    let builders = [];\r\n    for (const type of types) {\r\n      builders.push(createInitialBuilder(constructor, type));\r\n    }\r\n    return builders;\r\n  }\r\n  else {\r\n    return new Proxy(() => { }, {\r\n      get(target, prop) {\r\n        const result = target[prop];\r\n        if (typeof result !== \"undefined\") {\r\n          return result;\r\n        }\r\n        target[prop] = createInitialBuilder(constructor, prop);\r\n        return target[prop];\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default builders;\r\n\r\n"],"names":["templateValues","args","strings","templateArgs","result","index","s","entries","push","arg","interpunct","RegExp","enhanceBuilder","builder","func","__webscript_enhancer","createInitialBuilder","constructor","type","createBuilder","props","prop","Proxy","apply","target","thisArg","children","first","Array","isArray","Object","isFrozen","i","length","__is_webscript_element","get","elementName","setPropertyValue","value","prototype","toString","call","newProps","join","[object Object]","indexOf","replace","types","Error","builders"],"mappings":"AAAA,SAASA,EAAeC,GACtB,MAAOC,KAAYC,GAAgBF,EAC7BG,EAAS,GACf,IAAK,MAAOC,EAAOC,KAAMJ,EAAQK,UAAW,CAChC,KAAND,GACFF,EAAOI,KAAKF,GAEd,IAAIG,EAAMN,EAAaE,QACJ,IAARI,GACTL,EAAOI,KAAKC,GAGhB,OAAOL,EAGT,IAAIM,EAAa,IAAIC,OAAO,IAAK,KAEpBC,MAAAA,EAAiB,CAACC,EAASC,KACtCD,EAAQE,qBAAuBD,EACxBD,GAGT,SAASG,EAAqBC,EAAaC,GA2EzC,OA1EA,SAASC,EAAcC,EAAOC,GAC5B,IAAIR,EAAU,IAAIS,MAAM,OAAW,CACjCC,MAAMC,EAAQC,EAASC,GACrB,GAA2C,mBAAhCF,EAAOT,qBAAqC,CACrD,IAAIA,EAAuBS,EAAOT,4BAC3BS,EAAOT,qBACd,IAAIX,EAASW,EAAqBF,EAASa,GAE3C,OADAF,EAAOT,qBAAuBA,EACvBX,EAET,IAAKuB,GAASD,EACVE,MAAMC,QAAQF,IAAUG,OAAOC,SAASJ,KAC1CD,EAAW1B,EAAe0B,IAExBE,MAAMC,QAAQT,EAAMM,YACtBN,EAAMM,SAASlB,QAAQkB,GACvBA,EAAWN,EAAMM,gBACVN,EAAMM,UAEf,IAAK,IAAIM,EAAI,EAAGA,EAAIN,EAASO,OAAQD,IAAK,CACxC,IAAIvB,EAAMiB,EAASM,GACA,mBAARvB,IAAqD,IAA/BA,EAAIyB,yBACnCR,EAASM,GAAKvB,KAGlB,OAAOQ,EAAYC,EAAME,KAAUM,IAErCS,IAAIX,EAAQY,GACV,GAA2B,iBAAhBA,EAA0B,CACnC,GAAoB,2BAAhBA,EACF,YAEuB,yBAAhBA,EACP,OAAOZ,EAAOY,GAMhB,SAASC,KAAoBpC,GAC3B,IAAKqC,GAASrC,EACd,QAAqB,IAAVqC,EAAuB,CAChC,GAAa,UAATjB,GAA8D,oBAA1CS,OAAOS,UAAUC,SAASC,KAAKH,GACrD,OAAOnB,EAAc,GAAI,MAE3B,IAAIuB,EAAW,IAAKtB,GAEpB,cADOsB,EAASrB,GACTF,EAAcuB,EAAU,SAExBd,MAAMC,QAAQS,IAAUR,OAAOC,SAASO,GAC/CA,EAAQtC,EAAeC,GAAM0C,KAAK,YAE3B1C,EAAKgC,OAAS,EACrBK,EAAQrC,UAEQ,UAAToB,GAA8D,oBAA1CS,OAAOS,UAAUC,SAASC,KAAKH,GAC1D,OAAOnB,EAAc,IAAKC,KAAUkB,GAAS,MAG/C,OAAOnB,EADU,IAAKC,EAAOwB,CAACvB,GAAOiB,GACN,MASjC,OAjCuC,IAA9BF,EAAYS,QAAQ,OAC3BT,EAAcA,EAAYU,QAAQpC,EAAY,MA0B9C2B,EAAiBC,MADC,UAAhBF,EACuBhB,EAGAA,EAAMgB,GAEjCf,EAAOe,EACAC,MAIb,OAAOxB,EAEFM,CAAc,GAAI,qBAI3B,SAAkBF,EAAa8B,EAAQ,IACrC,GAA2B,mBAAhB9B,EACT,MAAM+B,MAAM,0EAEd,GAAID,EAAMd,OAAS,EAAG,CACpB,IAAIgB,EAAW,GACf,IAAK,MAAM/B,KAAQ6B,EACjBE,EAASzC,KAAKQ,EAAqBC,EAAaC,IAElD,OAAO+B,EAGP,WAAW3B,MAAM,OAAW,CAC1Ba,IAAIX,EAAQH,GACV,MAAMjB,EAASoB,EAAOH,GACtB,YAAsB,IAAXjB,EACFA,GAEToB,EAAOH,GAAQL,EAAqBC,EAAaI,GAC1CG,EAAOH"}