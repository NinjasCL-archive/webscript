{"version":3,"file":"webscript.modern.js","sources":["../src/webscript.js"],"sourcesContent":["function templateValues(args) {\r\n  const [strings, ...templateArgs] = args;\r\n  const result = [];\r\n  for (const [index, s] of strings.entries()) {\r\n    if (s !== \"\") {\r\n      result.push(s);\r\n    }\r\n    let arg = templateArgs[index];\r\n    if (typeof arg !== \"undefined\") {\r\n      result.push(arg);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nlet interpunct = new RegExp(\"·\", \"g\");\r\n\r\nfunction createInitialBuilder(constructor, type) {\r\n  function setPropertyValue(...args) {\r\n    let [value] = args;\r\n    let { props, prop } = this.__element_info__;\r\n    if (typeof value === \"undefined\") {\r\n      props = { ...props };\r\n      delete props[prop];\r\n      return createBuilder({ props, prop: null });\r\n    }\r\n    else if (Array.isArray(value) && Object.isFrozen(value)) {\r\n      value = templateValues(args).join(\"\");\r\n    }\r\n    else if (args.length > 1) {\r\n      value = args;\r\n    }\r\n    props = { ...props, [prop]: value };\r\n    return createBuilder({ props, prop: null });\r\n  }\r\n  function setPropsValues(props) {\r\n    let { props: existingProps } = this.__element_info__;\r\n    props = { ...existingProps, ...props };\r\n    return createBuilder({ props, prop: null });\r\n  }\r\n  function createBuilder(propsInfo) {\r\n    let builder = new Proxy(() => { }, {\r\n      apply(target, thisArg, children) {\r\n        let { props } = builder.__element_info__;\r\n        if (typeof props.exec === \"function\") {\r\n          let exec = props.exec;\r\n          delete props.exec;\r\n          let result = exec(builder, children);\r\n          props.exec = exec;\r\n          return result;\r\n        }\r\n        let [first] = children;\r\n        if (Array.isArray(first) && Object.isFrozen(first)) {\r\n          children = templateValues(children);\r\n        }\r\n        if (Array.isArray(props.children)) {\r\n          props.children.push(...children)\r\n          children = props.children;\r\n          delete props.children;\r\n        }\r\n        for (let i = 0; i < children.length; i++) {\r\n          let arg = children[i];\r\n          if (typeof arg === \"function\" && arg.__element_info__) {\r\n            children[i] = arg();\r\n          }\r\n        }\r\n        return constructor(type, props, ...children);\r\n      },\r\n      get(target, prop) {\r\n        if (prop === \"props\") {\r\n          return setPropsValues;\r\n        }\r\n        else if (prop === \"__element_info__\") {          \r\n          return target[prop]\r\n        }\r\n        else if (typeof prop === \"string\") {\r\n          if (prop.indexOf(\"·\") !== -1) {\r\n            prop = prop.replace(interpunct, \"-\");\r\n          }\r\n          if (prop.endsWith(\"Value\") && prop.length > 5) {\r\n            return target.__element_info__.props[prop.slice(0, -5)];\r\n          }\r\n          target.__element_info__.prop = prop;\r\n          return setPropertyValue;\r\n        }\r\n      }\r\n    })\r\n    builder.__element_info__ = propsInfo;\r\n    return builder;\r\n  }\r\n  return createBuilder({ props: {}, prop: null });\r\n}\r\n\r\n\r\nfunction builders(constructor, types = []) {\r\n  if (typeof constructor !== \"function\") {\r\n    throw Error(\"elementConstructor argument must be present and it must be a function.\");\r\n  }\r\n  if (types.length > 0) {\r\n    let builders = [];\r\n    for (const element of types) {\r\n      builders.push(createInitialBuilder(constructor, element));\r\n    }\r\n    return builders;\r\n  }\r\n  else {\r\n    return new Proxy(() => { }, {\r\n      get(target, prop) {\r\n        const result = target[prop];\r\n        if (typeof result !== \"undefined\") {\r\n          return result;\r\n        }\r\n        target[prop] = createInitialBuilder(constructor, prop);\r\n        return target[prop];\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default builders;\r\n"],"names":["templateValues","args","strings","templateArgs","result","index","s","entries","push","arg","interpunct","RegExp","createInitialBuilder","constructor","type","setPropertyValue","value","props","prop","this","__element_info__","createBuilder","Array","isArray","Object","isFrozen","join","length","[object Object]","setPropsValues","existingProps","propsInfo","builder","Proxy","apply","target","thisArg","children","exec","first","i","get","indexOf","replace","endsWith","slice","types","Error","builders","element"],"mappings":"AAAA,SAASA,EAAeC,GACtB,MAAOC,KAAYC,GAAgBF,EAC7BG,EAAS,GACf,IAAK,MAAOC,EAAOC,KAAMJ,EAAQK,UAAW,CAChC,KAAND,GACFF,EAAOI,KAAKF,GAEd,IAAIG,EAAMN,EAAaE,QACJ,IAARI,GACTL,EAAOI,KAAKC,GAGhB,OAAOL,EAGT,IAAIM,EAAa,IAAIC,OAAO,IAAK,KAEjC,SAASC,EAAqBC,EAAaC,GACzC,SAASC,KAAoBd,GAC3B,IAAKe,GAASf,GACVgB,MAAEA,EAAFC,KAASA,GAASC,KAAKC,iBAC3B,YAAqB,IAAVJ,GACTC,EAAQ,IAAKA,UACNA,EAAMC,GACNG,EAAc,CAAEJ,MAAAA,EAAOC,KAAM,SAE7BI,MAAMC,QAAQP,IAAUQ,OAAOC,SAAST,GAC/CA,EAAQhB,EAAeC,GAAMyB,KAAK,IAE3BzB,EAAK0B,OAAS,IACrBX,EAAQf,GAEVgB,EAAQ,IAAKA,EAAOW,CAACV,GAAOF,GACrBK,EAAc,CAAEJ,MAAAA,EAAOC,KAAM,QAEtC,SAASW,EAAeZ,GACtB,IAAMA,MAAOa,GAAkBX,KAAKC,iBAEpC,OAAOC,EAAc,CAAEJ,MADvBA,EAAQ,IAAKa,KAAkBb,GACDC,KAAM,OAEtC,SAASG,EAAcU,GACrB,IAAIC,EAAU,IAAIC,MAAM,OAAW,CACjCC,MAAMC,EAAQC,EAASC,GACrB,IAAIpB,MAAEA,GAAUe,EAAQZ,iBACxB,GAA0B,mBAAfH,EAAMqB,KAAqB,CACpC,IAAIA,EAAOrB,EAAMqB,YACVrB,EAAMqB,KACb,IAAIlC,EAASkC,EAAKN,EAASK,GAE3B,OADApB,EAAMqB,KAAOA,EACNlC,EAET,IAAKmC,GAASF,EACVf,MAAMC,QAAQgB,IAAUf,OAAOC,SAASc,KAC1CF,EAAWrC,EAAeqC,IAExBf,MAAMC,QAAQN,EAAMoB,YACtBpB,EAAMoB,SAAS7B,QAAQ6B,GACvBA,EAAWpB,EAAMoB,gBACVpB,EAAMoB,UAEf,IAAK,IAAIG,EAAI,EAAGA,EAAIH,EAASV,OAAQa,IAAK,CACxC,IAAI/B,EAAM4B,EAASG,GACA,mBAAR/B,GAAsBA,EAAIW,mBACnCiB,EAASG,GAAK/B,KAGlB,OAAOI,EAAYC,EAAMG,KAAUoB,IAErCI,IAAG,CAACN,EAAQjB,IACG,UAATA,EACKW,EAES,qBAATX,EACAiB,EAAOjB,GAES,iBAATA,IACa,IAAvBA,EAAKwB,QAAQ,OACfxB,EAAOA,EAAKyB,QAAQjC,EAAY,MAE9BQ,EAAK0B,SAAS,UAAY1B,EAAKS,OAAS,EACnCQ,EAAOf,iBAAiBH,MAAMC,EAAK2B,MAAM,GAAI,KAEtDV,EAAOf,iBAAiBF,KAAOA,EACxBH,aAKb,OADAiB,EAAQZ,iBAAmBW,EACpBC,EAET,OAAOX,EAAc,CAAEJ,MAAO,GAAIC,KAAM,sBAI1C,SAAkBL,EAAaiC,EAAQ,IACrC,GAA2B,mBAAhBjC,EACT,MAAMkC,MAAM,0EAEd,GAAID,EAAMnB,OAAS,EAAG,CACpB,IAAIqB,EAAW,GACf,IAAK,MAAMC,KAAWH,EACpBE,EAASxC,KAAKI,EAAqBC,EAAaoC,IAElD,OAAOD,EAGP,WAAWf,MAAM,OAAW,CAC1BQ,IAAIN,EAAQjB,GACV,MAAMd,EAAS+B,EAAOjB,GACtB,YAAsB,IAAXd,EACFA,GAET+B,EAAOjB,GAAQN,EAAqBC,EAAaK,GAC1CiB,EAAOjB"}